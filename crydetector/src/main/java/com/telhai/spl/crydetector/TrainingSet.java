package com.telhai.spl.crydetector;

import static com.telhai.spl.crydetector.MFCC2.FreqScale.*;
import static com.telhai.spl.crydetector.MFCC2.WindowMode.*;

/**
 * Created by Dima Ruinskiy on 1/15/17.
 * <p>
 * This class holds training set data which is pre-computed using MATLAB and is used here only for
 * the classification.
 * <p>
 * During creation of the training set, the setSpecifier parameter passed to the constructor causes
 * one of possibly several training sets to be selected.
 * <p>
 * Currently supported training sets:
 * - Infant_Cry_Detection_160719.m
 * - Infant_Cry_Detection_170728_11025.m
 * <p>
 * TODO: Create policy class which will coordinate feature vector and order across all classes
 */
public class TrainingSet
{

    private static final double[] g_XMin1607 = {
            -9.78618132420344,
            -8.54307378154144,
            -5.65012538013816,
            -3.04097732998904,
            -5.96408919689747,
            -2.60130709590178,
            -3.98085966275066,
            -3.4657136777329,
            -2.60987904113839,
            -2.95207564926141,
            -2.73009507135936,
            -2.58759325970084,
            -2.04572924028033,
            -2.39703057552168,
            -1.95751480590536,
            -2.33155610032154,
            -1.7790413627205,
            -1.92389268311267,
            -1.58531495592049,
            -1.87751659483033,
            -2.15264076985959,
            -2.19087767037013,
            -2.44126367553809,
            -2.10040298570378,
            -1.98241264838234,
            -1.62956252163956,
            -1.82384555089461,
            -1.66871992609038,
            -1.69405943025487,
            -1.45361637245586,
            -1.28405571715251,
            -1.17660490129193,
            -1.19714911590679,
            -1.01030198120343,
            -1.33981662175528,
            -0.930561202818477,
            -1.30129846727886,
            -1.02308228312092,
            5.91834708001515e-06,
            0.01123046875,
            0,
            -21274.8046875,
            -2817.64075941486,
            0.122471814002676,
            0
    };
    private static final double[] g_XRange1607 = {
            15.7162652241439,
            13.388778576331,
            10.8062497136055,
            6.64306825686704,
            8.18998743507059,
            7.16539999002551,
            6.21730059523738,
            6.3749283360451,
            5.9676787493543,
            6.53150036179478,
            5.65037128876924,
            4.76231013250655,
            4.76458117881472,
            4.47261446189507,
            4.71114544375238,
            4.80246104392287,
            4.40298937508357,
            4.16747460770582,
            4.14713533721435,
            3.92062882026573,
            4.02369835814251,
            4.32601721192563,
            4.60493803427238,
            3.62328013760753,
            3.54337772547157,
            3.01244843406868,
            3.14913301128327,
            3.18718377431493,
            3.3154567371058,
            2.95647679589017,
            2.47916016478063,
            2.50992644424874,
            2.2826555940433,
            2.35370758802453,
            2.80197473033816,
            2.18698581810902,
            2.44278419610981,
            2.22444390568497,
            3.41097262580629,
            0.489501953125,
            490,
            21415.0465745192,
            2943.46387282198,
            2.8080908481422,
            6,
    };
    private static final double[] g_Theta1607 = {
            0.689685436898339,
            -2.32605377425161,
            -0.336073762563656,
            -0.97359048985267,
            -1.56546762210771,
            1.3828640398416,
            1.0066813544093,
            -1.06408873458021,
            1.32180010811371,
            0.438299512678112,
            -1.26498281726332,
            -0.233686411472554,
            0.852003338333434,
            -0.321628789872544,
            0.28027499703626,
            0.661333618448863,
            0.149910330122153,
            -0.10863157865965,
            0.242784763356421,
            -0.0509474834201448,
            -0.0239871108449165,
            0.0384286701264054,
            -0.169005191051467,
            -0.331295754508951,
            -0.0886097694990286,
            0.440688989310134,
            -0.275088322986483,
            0.353303440852417,
            0.410063398523962,
            0.190564232655577,
            0.403780087553897,
            0.463563903887515,
            0.198095979661632,
            0.344978144801737,
            0.185930167861418,
            0.234531378934243,
            -0.207214766004045,
            0.0756447873725595,
            0.00820800458272574,
            0.120923498712308,
            -0.113617755042279,
            0.351579835400468,
            -0.00267667609504314,
            0.0685510733844521,
            -0.0187925078535326,
            0.59719204679837,
            -2.75703812350802,
            -0.40985540780136,
            -1.06042161641934,
            -1.68279968856227,
            1.3394399999817,
            0.96905673995847,
            -1.20253145688463,
            1.30142673058639,
            0.560347611626048,
            -1.2108898841198,
            -0.215115300650757,
            0.907041788975826,
            -0.426709873749666,
            0.279935925419986,
            0.685856310501531,
            0.129291178388411,
            -0.144173907548227,
            0.228960743581775,
            -0.142201389499235,
            -0.132900205952807,
            0.0198420043679403,
            -0.189230596877643,
            -0.352329697796637,
            -0.125029122935436,
            0.376253152417856,
            -0.336347056089479,
            0.346632476333462,
            0.423902877728031,
            0.109718194951756,
            0.402954082817626,
            0.441937831056384,
            0.0866099426383542,
            0.290703231382605,
            0.113820170255249,
            0.181454054608722,
            -0.231603749750975,
            0.152281342189144,
            -0.0157730334358327,
            -0.296836846173086,
            0.0295736418687225,
            0.234519733664169,
            0.0312533310389478,
            -0.267715107783142,
            0.0492167392107682
    };
    private static final double[] g_XMin1709 = {
            -12.9547494061093,
            -8.61137957234978,
            -11.6971341361196,
            -10.644127032926,
            -10.3139968563533,
            -8.05663545301734,
            -10.15863043589,
            -11.6929535673788,
            -9.36978836050784,
            -8.95537496189886,
            -8.6124817451039,
            -8.13555029966426,
            -8.35707717953549,
            -8.85800782250849,
            -8.72359331007181,
            -8.67115376326107,
            -7.91215746380235,
            -8.18573957475877,
            -8.14275315665665,
            -7.86722735655505,
            -7.65928803395712,
            -7.60035488249621,
            -8.03027289760725,
            -7.36683996053054,
            -7.20998623679948,
            -7.08359132993386,
            -7.15313520624498,
            -7.03550678192153,
            -6.93244318054557,
            -6.92034742016317,
            -6.6991525387675,
            -6.64854816599891,
            -6.47940950989436,
            -6.63073872303524,
            -6.28529976716846,
            -5.87364366994288,
            -5.59471180033839,
            -5.16497201190699,
            -4.76772991548745,
            -4.29031021955459,
            1.28135030192711e-06,
            0.0234375,
            0,
            0,
            -5129.208984375,
            -2817.64075941486,
            0.118740155889895,
            0,
            -42.9443543381533,
            269.1650390625
    };
    private static final double[] g_XRange1709 = {
            8.61417986416823,
            8.61417986416823,
            11.316008971157,
            11.316008971157,
            10.6416493760359,
            8.10705270503829,
            10.2978901731019,
            12.0792548808887,
            8.89789693508859,
            9.2538809345824,
            8.92848396716751,
            8.59317914669218,
            9.48282884020858,
            9.92356283736317,
            10.1226749912083,
            10.6354603842778,
            9.97742633155081,
            9.63220986698869,
            10.1615363487743,
            10.5640678091188,
            10.8731091918843,
            10.907623755046,
            11.1497310030537,
            9.33539681416586,
            9.46677803257308,
            8.58172217488475,
            9.18670230615799,
            8.17150381296893,
            8.42745332400301,
            8.71215376094763,
            8.81176152285918,
            8.78027706716412,
            9.25578571367881,
            8.67432882516107,
            8.31418809629657,
            7.64137377832456,
            7.80362072739744,
            7.61549752915478,
            7.26022228364093,
            7.10886496586172,
            5.06614461031982,
            0.849609375,
            580.263157894737,
            10,
            5290.39288776677,
            2933.55896900941,
            2.47182028086305,
            6,
            62.925888532417,
            4877.2705078125
    };
    private static final double[] g_Theta1709 = {
            -2.64681984034114,
            -0.00157037464069692,
            -1.99315797408931,
            -1.9931581515045,
            -2.03831319087105,
            1.0048955526146,
            -0.719748113949165,
            -1.17131401578448,
            -1.15396181141354,
            -1.59159623407316,
            -0.20991330983848,
            -0.688581267427598,
            0.659901766455528,
            -0.85923392521866,
            -0.915830524461131,
            0.706647666100772,
            0.373521765418084,
            1.02204899483584,
            1.48153838391162,
            2.27062162651611,
            2.25134503380552,
            2.35032932608066,
            -0.281150389212959,
            1.30701619755093,
            0.0935234609744975,
            -0.969309086543188,
            0.370870785442423,
            -0.851935948936199,
            -0.459322077140507,
            -0.346361756017748,
            0.274087968945042,
            1.99677663649363,
            3.18625595958747,
            0.21311702734958,
            -0.554192091624143,
            1.52841700801911,
            1.63701100490845,
            2.24696544151535,
            1.7805031030995,
            3.56054747899649,
            0.412914038885333,
            1.63173738305904,
            -0.101182603188368,
            1.92953999097036,
            1.92809284079478,
            -0.265276291047549,
            1.84626816586209,
            0.189964558353358,
            1.35499686757811,
            1.92787999078001,
            0.960244048924442,
            0.960244044912834,
            1.24748327155193,
            1.24748327092409,
            0.375754470050209,
            -0.666979795738876,
            -0.564793235618819,
            0.65046105077432,
            0.370909146893889,
            -0.161573043261525,
            0.888754259951999,
            -0.172238993234918,
            0.31759380054544,
            -1.64279386092411,
            -1.26306317027662,
            -0.357544435363225,
            -0.880661907418341,
            -0.355213567083054,
            -0.508182793467474,
            0.22470154880218,
            1.06914537443272,
            0.53115878343527,
            0.314762172923221,
            -0.0661171428550811,
            -0.0522092430483322,
            0.903472927450662,
            1.59232256402359,
            -0.376160621553558,
            -0.667259144005999,
            -0.654511221039742,
            -1.17101712787913,
            -1.06472872880267,
            -0.393325981465531,
            -2.60215393387497,
            -2.66939638341943,
            -2.54710345854128,
            -4.1157317816444,
            -0.137315960064637,
            1.25442722989121,
            0.388953221590107,
            0.0230630981574906,
            -5.36121684374436,
            -0.441211078671347,
            -0.40925536219843,
            -2.6385788939863,
            0.547702870369596,
            -4.11629241731081,
            0.121217123428192,
            -0.949566786769512,
            -2.34639962032633
    };
    public final double[] minValue;
    public final double[] range;
    public final double[] theta;

    public TrainingSet(SpecificTrainingSet setSpecifier)
    {
        switch(setSpecifier)
        {
            case SET_1607:
                minValue = g_XMin1607;
                range = g_XRange1607;
                theta = g_Theta1607;
                break;
            case SET_1709_11K:
                minValue = g_XMin1709;
                range = g_XRange1709;
                theta = g_Theta1709;
                break;
            case SET_UNKNOWN:
            default:
                minValue = null;
                range = null;
                theta = null;
        }
    }

    public static FeatureSet FeatureSet(SpecificTrainingSet setSpecifier)
    {
        IScalarFeature[] mScalarFeatures;
        IVectorFeature[] mVectorFeatures;
        FeatureSet featureSet = new FeatureSet();

        switch(setSpecifier)
        {

            case SET_1607:
                mScalarFeatures = new IScalarFeature[3];
                mScalarFeatures[0] = new ShortTimeEnergyFeature();          // Energy
                mScalarFeatures[1] = new ZeroCrossingRateFeature();         // ZCR
                mScalarFeatures[2] = new Formant1Feature();                 // First Formant

                mVectorFeatures = new IVectorFeature[2];
                mVectorFeatures[0] = new MFCCVectorFeature();               // MFCC
                mVectorFeatures[1] = new PitchParametersVectorFeature();    // Pitch and related parameters

                break;

            case SET_1709_11K:

                mScalarFeatures = new IScalarFeature[5];
                mScalarFeatures[0] = new ShortTimeEnergyFeature();          // Energy
                mScalarFeatures[1] = new ZeroCrossingRateFeature();         // ZCR
                mScalarFeatures[2] = new Formant1Feature();                 // First Formant
                mScalarFeatures[3] = new BandEnergyRatioFeature();          // Band Energy Ratio
                mScalarFeatures[4] = new SpectrumRolloffFeature();          // Spectrum Rolloff

                mVectorFeatures = new IVectorFeature[2];
                mVectorFeatures[0] = new FilterBankEnergyVectorFeature();   // Mel/ERB/Bark Filter Bank Energy
                mVectorFeatures[1] = new PitchParametersVectorFeature();    // Pitch and related parameters

                break;

            case SET_UNKNOWN:
            default:
                throw new RuntimeException("Unknown training set specifier");

        }
        featureSet.mScalarFeatures = mScalarFeatures;
        featureSet.mVectorFeatures = mVectorFeatures;

        return featureSet;
    }

    public static MFCC2 getMFCCComputer(SpecificTrainingSet setSpecifier)
    {
        switch(setSpecifier)
        {

            case SET_1607:
                return new MFCC2(4096, 4096, 39, 39, 44100, WIN_HAMMING, SCALE_MEL);
            case SET_1709_11K:
                return new MFCC2(1024, 1024, 40, 40, 11025, WIN_TRIANG, SCALE_ERB);
            default:
                throw new RuntimeException("Unknown training set specifier");
        }
    }

    public enum SpecificTrainingSet
    {
        SET_1607,
        SET_1709_11K,
        SET_UNKNOWN
    }

    public static class FeatureSet
    {
        public IScalarFeature[] mScalarFeatures;
        public IVectorFeature[] mVectorFeatures;
    }

}
